# Uses https://mise.jdx.dev/

### Development dependencies ###################################################

[tools]

rust = { version = "1.93", components = "rust-analyzer" }
prek = "latest"
'cargo:cargo-tarpaulin' = "latest"
ast-grep = "latest"

[settings]
lockfile = true
task_output = "interleave"

### Environment ################################################################

# Use ./tmp as the development workspace directory
[env]
AUGENT_WORKSPACE = "{{ [config_root] | concat(with='tmp') | join_path }}"

# Run augent by name (instead of cargo run --) in the project directory
[shell_alias]
augent = "cargo build --quiet --manifest-path {{ [config_root] | concat(with='Cargo.toml') | join_path }} && {{ [config_root] | concat(with='target/debug/augent') | join_path }}"
ag = "augent"

### Tasks ######################################################################

# Usage: mise <task-name> [task-args]

[tasks.check]
description = "Run all checks"
alias = "c"
run = [{ task = "lint" }, { task = "test" }, { task = "hooks" }]

[tasks.lint]
description = "Run clippy"
run = "cargo clippy --all-targets --all-features -- -D warnings"

[tasks.test]
description = "Run tests"
run = "cargo test"

[tasks.hooks]
description = "Run pre-commit hooks"
run = [
    "prek install --hook-type pre-commit --hook-type commit-msg",
    "prek run --all-files"
]

[tasks.cov]
description = "Run tests with coverage"
run = "cargo tarpaulin"

[tasks.lizard]
description = "Run lizard complexity analysis with duplicate detection"
run = "echo 'Rules:\n- Cyclomatic complexity threshold (warn if CCN > 10)\n- Length of function threshold (warn if function has > 50 lines)\n- Number of parameters threshold (warn if function has > 5 parameters)\n- Duplicate detection enabled\n- Token count threshold (warn if > 250 tokens)\n' && uvx lizard -C 10 -L 50 -a 5 -T token_count=250 -Eduplicate --warnings_only src/"
