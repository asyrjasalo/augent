# Workspace Configuration

Augent workspaces are your working Git repositories where bundles are installed and configured. This document explains workspace structure, configuration files, and how bundles integrate into workspaces.

---

## Overview

A **workspace** is a Git repository containing:

- Augent configuration in `.augent/` directory
- Installed resources in AI coding platform directories
- Metadata tracking which bundles provide which resources

Augent automatically initializes workspaces when needed.

---

## Workspace Structure

```text
my-project/
├── .augent/                           # Augent workspace directory
│   ├── augent.yaml                    # Workspace bundle definition
│   ├── augent.lock                    # Locked bundle versions
│   └── augent.workspace.yaml          # Resource tracking
├── .claude/                           # Claude Code configuration
├── .cursor/                           # Cursor configuration
├── .opencode/                         # OpenCode configuration
├── CLAUDE.md                          # Claude Code agent config
├── AGENTS.md                          # Shared agent configuration
└── ...                                # Your project files
```

---

## Configuration Files

### augent.yaml

Defines bundles installed in workspace:

```yaml
name: my-project
description: My awesome project
bundles:
  - github:author/debug-tools
  - github:author/testing-helpers
  - ./local-bundle
```

**Bundle order matters:** Later bundles override earlier bundles.

### augent.lock

Auto-generated lockfile with resolved versions:

```yaml
bundles:
  - name: debug-tools
    source:
      Git:
        url: https://github.com/author/debug-tools.git
        ref: main
        resolved_sha: abc123def456...
    files:
      - rules/debug.md
      - skills/analyze.md
    hash: blake3_hash_value
```

**Never manually edit** - regenerated on install.

### augent.workspace.yaml

Tracks which bundles provide which resources:

```yaml
name: my-project
bundles:
  - name: debug-tools
    enabled:
      rules/debug.md:
        - .claude/rules/debug.md
        - .cursor/rules/debug.mdc
      skills/analyze.md:
        - .claude/skills/analyze.md
        - .cursor/skills/analyze.mdc
```

Each bundle lists its **bundle-relative paths** (e.g. `rules/debug.md`) and the **installed platform paths** (e.g. `.claude/rules/debug.md`). Augent uses this for conflict detection, modification tracking, and uninstallation.

**Optional:** This file is automatically generated. If deleted or missing, Augent will rebuild it by scanning installed files.

---

## Lazy Workspace Configuration

Augent can work without an `augent.workspace.yaml` file. This is useful when:

- Migrating from another system
- Workspace config is corrupted or deleted
- First time installing bundles in a workspace

### How It Works

When `augent.workspace.yaml` is missing:

1. **On Install**: Augent installs bundles normally and generates the workspace config file
2. **On Uninstall**: Before removing files, Augent scans the workspace to rebuild the workspace config by:
   - Detecting which platforms are installed (`.dirs` present)
   - Scanning each platform directory for installed files
   - Matching files to bundles from the lockfile
   - Reconstructing the workspace configuration

### Example: Migrating a Workspace

```bash
# Scenario: You have .augent/augent.lock but no augent.workspace.yaml

# List works (reads from lockfile)
augent list

# Uninstall rebuilds workspace.yaml first
augent uninstall my-bundle
# Output: Workspace configuration is missing. Rebuilding from installed files...
# Then proceeds with uninstall
```

### Workspace Scanning Behavior

When rebuilding `augent.workspace.yaml`, Augent:

1. **Detects all platforms**: Dynamically checks for any of the 14 supported platforms defined in the system (including `.claude/`, `.cursor/`, `.opencode/`, `.windsurf/`, `.gemini/`, `.agent/`, `.augment/`, `.codex/`, `.factory/`, `.kilocode/`, `.kiro/`, `.qwen/`, `.roo/`, `.warp/`, and more)
2. **Scans for files**: For each bundle in the lockfile, searches for its files across all detected platform directories
3. **Handles transformations**: Uses platform-specific transformation rules to find files (e.g., `.md` → `.mdc` for Cursor rules, `.md` → `{name}/SKILL.md` for OpenCode skills)
4. **Reconstructs mapping**: Records which files are installed where

**Platform Independence**: The detection system is fully platform-agnostic—it automatically detects any platform defined in the system configuration without hardcoding specific platforms. New platforms can be added via `platforms.jsonc` configuration files.

---

## Workspace Initialization

Augent initializes workspaces automatically on first `install`:

### Auto-Detection

```bash
cd /path/to/my-git-repo
augent install github:author/bundle
# .augent/ automatically created
```

### Manual Initialization

```bash
cd /path/to/my-git-repo
augent install github:author/bundle
# Workspace initialized with inferred name from git remote
```

### Naming

Augent infers workspace name from git remote:

| Git Remote | Workspace Name |
|-----------|----------------|
| `github.com/username/project` | `username/project` |
| `gitlab.com/username/project` | `username/project` |
| No remote | `<username>/<directory>` |

---

## Resource Installation

### How Resources Flow

1. **Download**: Bundle fetched to cache (`~/.cache/augent/bundles/`)
2. **Transform**: Resources transformed to AI coding platform-specific format
3. **Merge**: Merged into existing resources (if applicable)
4. **Install**: Copied to AI coding platform directories
5. **Track**: Metadata added to `augent.workspace.yaml`

### Installation Locations

| Resource Type | Cursor | Claude Code | OpenCode |
|--------------|--------|-------------|----------|
| Rules | `.cursor/rules/` | `.claude/rules/` | `.opencode/rules/` |
| Skills | `.cursor/skills/` | `.claude/skills/` | `.opencode/skills/` |
| Commands | `.cursor/commands/` | `.claude/commands/` | `.opencode/commands/` |
| MCP | `.cursor/mcp.jsonc` | `.claude/mcp.jsonc` | `.opencode/mcp.jsonc` |
| AGENTS.md | Merged into `AGENTS.md` | Merged into `CLAUDE.md` | Merged into `AGENTS.md` |
| Root files | Copied to workspace root |  |  |

### Merge Strategies

| File Type | Merge Strategy | Behavior |
|-----------|----------------|----------|
| Rules/Skills/Commands | Replace | Later bundle overwrites earlier |
| MCP.jsonc | Composite | Config merged, later values override |
| AGENTS.md | Composite | Text merged with delimiter |
| Root files | Replace | Later bundle overwrites earlier |

---

## Modified File Detection

Augent tracks modifications to prevent data loss:

### Detection Process

1. Calculate hash of original file from cached bundle
2. Compare with current workspace file hash
3. If different, file is marked as modified
4. Modified files are copied to workspace bundle directory

### Handling Modified Files

**Before uninstall:**

```bash
augent uninstall my-bundle
# Warning: Some files modified
# Modified files backed up locally
```

**Before install:**

```bash
augent install new-bundle
# Warning: New bundle would overwrite modified files
# Modified files preserved locally
```

### Checking Modifications

```bash
# Augent warns about modifications automatically
augent install github:author/new-bundle

# View workspace configuration to see tracking
cat .augent/augent.workspace.yaml
```

---

## Platform Detection

Augent automatically detects installed AI coding platforms:

### Detection Methods

1. **Directory Check**
   - `.claude/` → Claude Code
   - `.cursor/` → Cursor
   - `.opencode/` → OpenCode

2. **File Check**
   - `CLAUDE.md` → Claude Code
   - `AGENTS.md` → Generic/OpenCode

### Installing for Specific Platforms

```bash
# Install only for specific platforms
augent install ./bundle --for cursor opencode

# Auto-detect platforms
augent install ./bundle
```

### Platform Aliases

| Alias | Full Name |
|-------|-----------|
| `claude` | `claude-code` |
| `cursor` | `cursor` |
| `opencode` | `opencode` |

---

## Locking and Reproducibility

### Lockfile Purpose

`augent.lock` ensures:

1. **Team consistency:** Same bundle versions across team
2. **Reproducibility:** Exact SHAs for all dependencies
3. **Safety:** Detects unexpected changes

### Frozen Install (CI/CD)

```bash
# Fail if lockfile would change
augent install --frozen
```

**Use cases:**

- CI/CD pipelines
- Production deployments
- Verifying exact dependencies

### Updating Lockfile

```bash
# Update to latest versions
augent install github:author/bundle

# Lockfile updated automatically
cat .augent/augent.lock
```

---

## Bundle Lifecycle

Understanding how bundles are managed throughout their lifecycle in your workspace.

### Adding Bundles to Configuration

When you add a bundle to `augent.yaml` and run `augent install`:

```yaml
# augent.yaml
bundles:
  - name: my-bundle
    path: ./my-bundle
```

**What happens:**

1. Bundle is resolved and its resources discovered
2. Bundle entry is added to `augent.lock` with exact SHA/reference
3. Bundle entry is added to `augent.workspace.yaml` with installed files
4. Resources are transformed and installed to platform directories

**Result:** Bundle is now tracked in both configuration and lockfile.

### Removing Bundles from Configuration

When you remove a bundle from `augent.yaml` and run `augent install`:

```yaml
# augent.yaml (before)
bundles:
  - name: old-bundle
    path: ./old-bundle
  - name: new-bundle
    path: ./new-bundle

# augent.yaml (after)
bundles:
  - name: new-bundle
    path: ./new-bundle
```

**What happens:**

1. Only bundles in current `augent.yaml` are resolved
2. Old bundle is NOT removed from `augent.lock`
3. Old bundle is NOT removed from `augent.workspace.yaml`
4. Old bundle's files are NOT uninstalled

**Why?** This design ensures:

- Bundles can be temporarily removed and re-added without re-resolving
- History is preserved in lockfile and workspace config
- Manual bundle management is possible without accidental deletions
- Team members can comment out bundles without losing configuration

### Explicitly Removing Bundles

To completely remove a bundle's resources and entries:

```bash
# Remove from configuration first
# (remove from augent.yaml)

# Then explicitly uninstall to clean up
augent uninstall my-bundle
```

**What happens:**

1. Files provided by bundle are removed (unless overridden by others)
2. Bundle entry is removed from `augent.lock`
3. Bundle entry is removed from `augent.workspace.yaml`
4. Dependencies are cleaned up if no other bundle needs them

### Configuration vs. Resolved State

Important distinction:

| Aspect | augent.yaml | augent.lock | augent.workspace.yaml |
|--------|------------|-------------|----------------------|
| **Contains** | Bundles to install | Resolved bundle info | Installed file tracking |
| **Updated when** | Manual edit + install | Bundle resolved | Files installed |
| **Removed when** | Manual deletion | `augent uninstall` | `augent uninstall` |
| **Manual edits** | Expected (bundles list) | Not recommended | Not recommended |
| **Persists after removal** | No | Yes (until uninstall) | Yes (until uninstall) |

### Workflow: Adding and Removing Bundles

```bash
# 1. Add bundle to configuration
echo "- name: my-bundle\n  path: ./my-bundle" >> .augent/augent.yaml

# 2. Install
augent install
# Bundle added to lock and workspace config

# 3. Later, temporarily disable
# Edit augent.yaml and comment out the bundle
vi .augent/augent.yaml

# 4. Install again
augent install
# Bundle entry REMAINS in lock and workspace config (good!)
# Files are NOT re-installed (no changes)

# 5. To truly remove, uninstall explicitly
augent uninstall my-bundle
# Now it's completely removed from all config files
```

---

## Workspace Cleanup

### Removing Bundles

```bash
augent uninstall my-bundle
# Removes bundle files
# Updates configuration
# Preserves modified files
```

### Resetting Workspace

```bash
# Remove all Augent configuration
rm -rf .augent

# Clean agent directories (optional)
rm -rf .claude .cursor .opencode

# Reinstall bundles
augent install github:author/bundle
```

### Clean Cache

```bash
# Show cache size
augent clean-cache --show-size

# Remove all cached bundles
augent clean-cache --all
```

---

## Best Practices

### Version Control

**Commit `.augent/` directory:**

```bash
git add .augent/
git commit -m "Add debug-tools bundle"
```

**Commit lockfile for reproducibility:**

```bash
git add .augent/augent.lock
git commit -m "Lock dependency versions"
```

**Don't commit:**

- Agent directories with secrets

### Bundle Ordering

**Order matters:** Put overrides last:

```yaml
bundles:
  - github:author/base-config      # Base configuration
  - github:author/team-standards   # Team standards
  - ./local-bundle                 # Project-specific (overrides all)
```

### Team Collaboration

1. **Share `.augent/augent.yaml`:** Defines team bundles
2. **Commit lockfile:** Ensures everyone uses same versions
3. **Document modifications:** Track manual changes to resources
4. **Use frozen installs in CI:** Prevents unexpected updates

---

## Troubleshooting

### Bundle Not Found

```bash
Error: Bundle not found: my-bundle
```

**Check:**

- Bundle name is correct
- Bundle is installed (`augent list`)
- Case sensitivity matters

### Conflicts

```bash
Warning: File already provided by another bundle
```

**Resolution:**

- Check bundle order in `augent.yaml`
- Later bundles override earlier bundles
- Adjust order if needed

### Modified Files

```bash
Warning: Some files were modified
```

**Action:**

- Modified files backed up locally
- Review before uninstalling
- Manually merge if needed

### Lockfile Mismatch

```bash
Error: Lockfile would change (use --frozen to fail)
```

**Resolution:**

- Update lockfile: `augent install github:author/bundle`
- Or use `--frozen` for CI/CD

---

## See Also

- [Commands Reference](commands.md) - Managing workspaces via CLI
- [Bundle Format](bundles.md) - Creating and publishing bundles
- [Architecture Documentation](implementation/architecture.md) - Implementation details
